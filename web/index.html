<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9. Project: Automatic Spam Complaint System
    </title>
    <style>
        :root {
            --color-primary: #2563eb; 
            --color-secondary: #10b981; 
            --color-warning: #f59e0b; 
            --color-text: #1f2937; 
            --color-background: #f9fafb; 
            --color-card-bg: white;
            --radius-lg: 0.75rem;
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--color-background); 
            padding: 1rem;
            transition: all 0.3s ease-in-out;
        }


        .container {
            max-width: 72rem; 
            margin-left: auto;
            margin-right: auto;
            background-color: var(--color-card-bg);
            box-shadow: var(--shadow-2xl);
            border-radius: var(--radius-lg);
            padding: 1.5rem; 
        }
        .tabs { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 2rem; 
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 12px;
        }

        .tab-btn { 
            background: #e5e7eb; 
            color: #4b5563; 
            border: none; 
            padding: 10px 20px; 
            cursor: pointer; 
            border-radius: var(--radius-lg); 
            font-weight: 700;
            transition: all 0.2s;
        }

        .tab-btn.active { 
            background: var(--color-primary); 
            color: white; 
        }
        .tab-content {
            display: none; 
        }

        .tab-content.active {
            display: block; 
        }
 
        textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid #d1d5db; 
            border-radius: var(--radius-lg);
            font-size: 0.875rem; /* text-sm */
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06); 
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
            resize: vertical;
        }
    

        button {
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            color: white;
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        button.action-btn {
            background-color: var(--color-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            font-weight: 700;
            cursor: pointer;
            margin-top: 1rem;
            width: 100%;
        }

        .whois-summary {
            margin: 2rem 0;
            padding: 1rem;
            background-color: #fef3c7; 
            border-left: 4px solid var(--color-warning);
            border-radius: var(--radius-lg);
        }

        pre {
            background: #1e293b;
            color: #34d399;
            padding: 1rem;
            border-radius: var(--radius-lg);
            overflow-x: auto;
            white-space: pre-wrap;
            border: 2px solid var(--color-secondary);
        }

        .history-item {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hidden { display: none; }
        .placeholder-hint { font-size: 0.8rem; color: #6b7280; margin-bottom: 0.5rem; }
        #rawEmailInput + button {
            background-color: var(--color-primary);
            width: 100%;
            margin-top: 0.75rem;
        }
        #rawEmailInput + button:hover {
            background-color: #1d4ed8; 
        }
       
        
        #resultsContainer button {
            background-color: var(--color-secondary);
            font-size: 0.875rem;
            padding: 0.5rem 1.25rem;
            margin-bottom: 0.75rem;
        }
        #resultsContainer button:hover {
            background-color: #059669; 
        }

       
        .whois-summary {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: #d8d4c5; 
            border-left: 4px solid var(--color-warning);
            border-radius: var(--radius-lg);
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

    
       
        #complaintOutput {
            white-space: pre-wrap;
            padding: 1rem;
            background-color: #070f1e; 
            color: white;
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            overflow-x: auto;
            border: 4px solid var(--color-secondary);
           
            max-height: 400px;
        }
     
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #6b7280; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background-color: #e5e7eb; 
        }

    </style>
</head>
<body>

<div class="container">
    <h1>Automatic Spam Complaint System</h1>

    <div class="tabs">
        <button id="btn-analyze" class="tab-btn active" onclick="showTab('analyze')">Analyze</button>
        <button id="btn-templates" class="tab-btn" onclick="showTab('settings')">Edit Template</button>
        <button id="btn-history" class="tab-btn" onclick="showTab('history')">Send and see History</button>
    </div>
     
    <div id="section-analyze" class="tab-content active">
        <div style="margin-bottom: 1.5rem;">
            <textarea id="rawEmailInput" rows="8" placeholder="Paste full email headers and body here..."></textarea>
            <button id="mainAnalyzeBtn" class="action-btn" onclick="runAnalysis()">Analyze Email & Generate Complaint</button>
        </div>

        <div id="resultsContainer" class="hidden">
            <div class="whois-summary">
                <h3>WHOIS Analysis</h3>
                <div id="whoisSummary"></div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3>Email Trace Route</h3>
                <pre id="traceRouteOutput"></pre>
            </div>

            <h3>Generated Abuse Complaint</h3>
            <pre id="complaintOutput"></pre>
            
            <button class="action-btn" style="background: var(--color-secondary)" onclick="trackComplaint()">Save to History</button>
        </div>
    </div>
   
    <div id="section-settings" class="tab-content">
        <h3>Edit Complaint Template</h3>
        <p class="placeholder-hint">Tags: {{ABUSE_EMAIL}}, {{IP}}, {{TIME}}, {{EVIDENCE}}</p>
        <textarea id="templateInput" rows="12">To: {{ABUSE_EMAIL}}
            Subject: Abuse Report: Unsolicited Email from IP {{IP}}

            Hello,

            Our system detected unsolicited activity from the following IP: {{IP}}
            Time of Detection: {{TIME}}
            Violation: Unsolicited Spam/Commercial Email

            Evidence:
            {{EVIDENCE}}

            Please investigate and take the necessary steps.
            Thank you.
        </textarea>
        <button class="action-btn" onclick="saveTemplate()" style="background: var(--color-warning)">Save Template</button>
    </div>

    <div id="section-history" class="tab-content">
        <div>
            <h3>Saved</h3>
            <div id="savedList"></div>
        </div>
        <div>
            <h3>Sent </h3>
            <div id="sentList"></div>
        </div>
        <div id="historyList"></div>
    </div>
</div>


<script>
   
    let currentComplaintData = null;
    let sentHistory = JSON.parse(localStorage.getItem('spam_history') || '[]');
    let savedHistory = JSON.parse(localStorage.getItem('spam_saved') || '[]');
    let customTemplate = localStorage.getItem('spam_template') || null;

   
    function showTab(tabId) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

        if (tabId === 'analyze') document.getElementById('btn-analyze').classList.add('active');
        if (tabId === 'settings') document.getElementById('btn-templates').classList.add('active');
        if (tabId === 'history') document.getElementById('btn-history').classList.add('active');

        document.querySelectorAll('.tab-content').forEach(section => section.classList.remove('active'));
        document.getElementById('section-' + tabId).classList.add('active');
        if (tabId === 'history') renderHistory();
    }

    function GenerateComplaint(template, abuseEmail, ip, time, evidence) {
        let result = template;
        result = result.replace(/{{ABUSE_EMAIL}}/g, abuseEmail);
        result = result.replace(/{{IP}}/g, ip);
        result = result.replace(/{{TIME}}/g, time);
        result = result.replace(/{{EVIDENCE}}/g, evidence);
        return result;
    }

    async function runAnalysis() {
        const btn = document.getElementById('mainAnalyzeBtn');
        const raw = document.getElementById('rawEmailInput').value.trim();
        if (!raw) return alert("Paste email source.");

        btn.disabled = true;
        btn.innerText = "analyzing with Go";

        try {
            const response = await fetch('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ rawEmail: raw })
            });

            const data = await response.json();
            if (data.error) throw new Error(data.error);

        currentComplaintData = {
            ip: data.targetIP,
            abuseEmail: data.abuseEmail,
            evidence: raw.substring(0, 500), 
            time: new Date().toUTCString(),
            trace: data.traceRoute
        };
        const tmpl = customTemplate || document.getElementById('templateInput').value;
        
        const finalComplaint = GenerateComplaint(
            tmpl, 
            currentComplaintData.abuseEmail, 
            currentComplaintData.ip, 
            currentComplaintData.time, 
            currentComplaintData.evidence
        );

        document.getElementById('whoisSummary').innerText = `Target IP: ${data.targetIP} \nAbuse Contact: ${data.abuseEmail}`;
        document.getElementById('complaintOutput').innerText = finalComplaint;
        document.getElementById('resultsContainer').classList.remove('hidden');
        document.getElementById('traceRouteOutput').innerText = data.traceRoute;

        } catch (err) {
            alert("Error: " + err.message);
        } finally {
            btn.disabled = false;
            btn.innerText = "Analyze email and generate complaint";
        }
    }

    function saveTemplate() {
        const val = document.getElementById('templateInput').value;
        localStorage.setItem('spam_template', val);
        customTemplate = val;
        alert("Template saved successfully!");
    }

    function trackComplaint() {
        if (!currentComplaintData) return;
        const entry = {
            ip: currentComplaintData.ip,
            email: currentComplaintData.abuseEmail,
            id: Date.now(),
            date: new Date().toLocaleString()
        };
        savedHistory.unshift(entry);
        localStorage.setItem('spam_saved', JSON.stringify(savedHistory.slice(0, 20)));
        alert("Saved");
    }

    function sendComplaint(id) {
    const index = savedHistory.findIndex(item => item.id === id);
    if (index === -1) return;

    const item = savedHistory.splice(index, 1)[0];
    item.sentDate = new Date().toLocaleString();
    
    sentHistory.unshift(item);
    
    localStorage.setItem('spam_saved', JSON.stringify(savedHistory));
    localStorage.setItem('spam_hystory', JSON.stringify(sentHistory));
    
    alert(`Complaint sent to: ${item.abuseEmail}`);
    renderHistory();
    }

    function renderHistory() {
        //const list = document.getElementById('historyList');
        const savedEl = document.getElementById('savedList');
        const sentEl = document.getElementById('sentList');

        if (sentHistory.length === 0) {
            list.innerHTML = "<p>No complaints sent yet.</p>";
            return;
        }
        savedEl.innerHTML = savedHistory.length ? savedHistory.map(item => `
        <div class="history-item">
            <div><strong>${item.ip}</strong><br><small>Saved at:${item.date}</small></div>
            <button onclick="sendComplaint(${item.id})" style="background:var(--color-primary); padding: 7px;">SEND</button>
        </div>
        `).join('') : "<p>None saved.</p>";

        sentEl.innerHTML = sentHistory.length ? sentHistory.map(item => `
        <div class="history-item">
            <div><strong>${item.ip}</strong> - ${item.abuseEmail}<br><small>Sent at: ${item.sentDate}</small></div>
        </div>
        `).join('') : "<p>None sent.</p>";
}

 
    if (customTemplate) {
        document.getElementById('templateInput').value = customTemplate;
    }
</script>



</body>
</html>